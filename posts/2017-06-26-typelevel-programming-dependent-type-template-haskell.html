<!-- htmlhint id-class-value:false / avoid the warnings to bootstrap names -->

<html>
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# website: http://ogp.me/ns/website#">
    <title>galaxy-sixth-sensey - 型レベルハンバーガーについての報告</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta property="og:url" content="https://aiya000.github.io" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="galaxy-sixth-sensey - 型レベルハンバーガーについての報告" />
    <meta property="og:description" content="ギャラクシー・シックス・センスワイ - プログラミング・数学・一次創作" />
    <meta property="og:site_name" content="galaxy-sixth-sensey" />
    <meta property="og:image" content="https://aiya000.github.io/images/mu-icon.png" />
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@public_ai000ya" />
    <meta name="twitter:creator" content="@public_ai000ya">
    <meta name="twitter:title" content="galaxy-sixth-sensey - 型レベルハンバーガーについての報告" />
    <meta name="twitter:description" content="ギャラクシー・シックス・センスワイ - プログラミング・数学・一次創作" />
    <meta name="twitter:image" content="https://aiya000.github.io/images/ogp-twitter-card-large.png" />
    <link rel="stylesheet" type="text/css" href="../node_modules/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" type="text/css" href="../css/default.css" />
    <link rel="stylesheet" type="text/css" href="../css/highlight.js/atom-one-dark.css" />
  </head>

  <body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
      <a class="navbar-brand" href="../">galaxy-sixth-sensey</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav mr-auto">
          <li>
            <a class="nav-link" href="../">Home</a>
          </li>
          <li>
            <a class="nav-link" href="../about.html">About</a>
          </li>
          <li>
            <a class="nav-link" href="../profile.html">Profile</a>
          </li>
          <li>
            <a class="nav-link" href="../products.html">Products</a>
          </li>
          <li>
            <a class="nav-link" href="../archive.html">Archive</a>
          </li>
        </ul>

        <div>
          <script async src="https://cse.google.com/cse.js?cx=005952339784006396697:rdanbqy7tbq"></script>
          <div class="gcse-search"></div>
        </div>
      </div>
    </nav>

    <link rel="stylesheet" type="text/css" href="../css/post.css" />

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
    <title>galaxy-sixth-sensey - 型レベルハンバーガーについての報告</title>
    <meta property="og:url" content="https://aiya000.github.io/posts/2017-06-26-typelevel-programming-dependent-type-template-haskell.html" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="galaxy-sixth-sensey - 型レベルハンバーガーについての報告" />
    <meta property="og:description" content="型レベルハンバーガーについての報告" />
    <meta property="og:site_name" content="galaxy-sixth-sensey" />
    <meta property="og:image" content="https://aiya000.github.io/images/mu-icon.png" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@public_ai000ya" />
    <meta name="twitter:creator" content="@public_ai000ya">
    <meta name="twitter:title" content="galaxy-sixth-sensey - 型レベルハンバーガーについての報告" />
    <meta name="twitter:description" content="型レベルハンバーガーについての報告" />
    <meta name="twitter:image" content="https://aiya000.github.io/images/mu-icon.png" />
</head>

<div class="post-info">
    <div class="post-date">2017/06/26</div>
    

    <div class="post-title">型レベルハンバーガーについての報告</div>

    <ul class="post-tags">
        
            <li>
                <i class="fas fa-tag"></i>
                <a href="../tags/Haskell.html">Haskell</a>
            </li>
        
    </ul>
</div>

<div class="post-body">
    <!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->
<ul>
<li>index
<ul>
<li><a href="#%E3%81%93%E3%82%8C%E3%81%AF%E7%A7%81%E7%9A%84%E3%81%AA%E8%BF%91%E6%B3%81%E5%A0%B1%E5%91%8A%E3%81%A7%E3%81%99">これは私的な近況報告です</a></li>
<li><a href="#%E8%A7%A3%E8%AA%AC">解説</a>
<ul>
<li><a href="#%E5%9E%8B%E3%83%AC%E3%83%99%E3%83%AB%E3%83%8F%E3%83%B3%E3%83%90%E3%83%BC%E3%82%AC%E3%83%BC%E3%81%AE%E7%9B%AE%E7%9A%84%E4%B8%BB%E9%A1%8C">型レベルハンバーガーの目的、主題</a></li>
<li><a href="#%E5%9E%8B%E3%83%AC%E3%83%99%E3%83%AB%E3%83%8F%E3%83%B3%E3%83%90%E3%83%BC%E3%82%AC%E3%83%BC%E3%81%AE%E8%A6%8B%E3%81%A9%E3%81%93%E3%82%8D">型レベルハンバーガーの見どころ</a></li>
<li><a href="#%E5%9E%8B%E3%83%AC%E3%83%99%E3%83%AB%E3%83%8F%E3%83%B3%E3%83%90%E3%83%BC%E3%82%AC%E3%83%BC%E3%81%B8%E3%81%AEtopping%E3%81%AE%E8%BF%BD%E5%8A%A0">型レベルハンバーガーへのToppingの追加</a></li>
<li><a href="#th.hs">型レベルプログラミングを解決するためにTemplateHaskellを使うのは1回 回った感がある（TH.hsについて）</a></li>
<li><a href="#%E5%80%A4%E3%83%AC%E3%83%99%E3%83%AB%E3%83%8F%E3%83%B3%E3%83%90%E3%83%BC%E3%82%AC%E3%83%BC">値レベルハンバーガー</a></li>
<li><a href="#%E3%81%A8%E3%81%84%E3%81%86%E3%81%93%E3%81%A8%E3%81%A7">ということで</a></li>
</ul></li>
<li><a href="#%E5%85%83%E3%83%8D%E3%82%BF">元ネタ</a></li>
<li><a href="#%E5%8F%82%E8%80%83">参考</a></li>
<li><a href="#special-thanks-">Special Thanks !</a></li>
</ul></li>
</ul>
<!-- END doctoc generated TOC please keep comment here to allow auto update -->
<h1 id="これは私的な近況報告です">これは私的な近況報告です</h1>
<p>　ここ4日くらいは型レベルプログラミングの体験をしていました！<br />
その成果物である、型レベルハンバーガーはHamburger.hs及びHamburger/TH.hsから成ります。</p>
<!-- 出力結果 {{{ -->
<p>出力結果</p>
<pre class="console"><code>SHamburger (Space Space Space Space)
SHamburger (Cheese Space Space Space)
SHamburger (Cheese Tomato Space Space)
SHamburger (Cheese Tomato Meet Space)
SHamburger (Cheese Tomato Meet Ushi)</code></pre>
<!-- }}} -->
<!-- Hamburger.hs {{{ -->
<ul>
<li><a href="https://github.com/aiya000/learning-Haskell/blob/d4d29ad26673e828bc0b0358d1cde42c295eb50b/Language/Haskell/Extension/Room/Hamburger.hs">Hamburger.hs</a></li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb2-1"><a href="#cb2-1"></a><span class="ot">{-# LANGUAGE DataKinds #-}</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="ot">{-# LANGUAGE FlexibleInstances #-}</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="ot">{-# LANGUAGE GADTs #-}</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="ot">{-# LANGUAGE TemplateHaskell #-}</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="ot">{-# LANGUAGE TypeFamilies #-}</span></span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="kw">module</span> <span class="dt">Hamberger</span> <span class="kw">where</span></span>
<span id="cb2-8"><a href="#cb2-8"></a></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="kw">import</span> <span class="dt">Hamburger.TH</span> (defineInstances)</span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">-- | A kind of the topping, and types.</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="kw">data</span> <span class="dt">Topping</span> <span class="ot">=</span> <span class="dt">Space</span> <span class="co">-- ^ Mean a space, it can be inserted some @Topping@</span></span>
<span id="cb2-13"><a href="#cb2-13"></a>             <span class="op">|</span> <span class="dt">Cheese</span> <span class="op">|</span> <span class="dt">Tomato</span> <span class="op">|</span> <span class="dt">Meet</span> <span class="op">|</span> <span class="dt">Ushi</span></span>
<span id="cb2-14"><a href="#cb2-14"></a></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">-- |</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">-- A type level function</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">-- that maps @HamburgerT@ and @Topping@ to @HamburgerT@.</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">--</span></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">-- If @HamburgerC a b c d@ :: @HamburgerT@ of the domain has no space, or @Fail@ is specified to the domain,</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">-- return @Fail@ type.</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="kw">type</span> <span class="kw">family</span> <span class="dt">AddTopping</span> (<span class="ot">h ::</span> <span class="dt">HamburgerT</span>) (<span class="ot">t ::</span> <span class="dt">Topping</span>)<span class="ot"> ::</span> <span class="dt">HamburgerT</span> <span class="kw">where</span></span>
<span id="cb2-22"><a href="#cb2-22"></a>  <span class="dt">AddTopping</span> (<span class="dt">HamburgerC</span> <span class="dt">Space</span> b c d) t <span class="ot">=</span> <span class="dt">HamburgerC</span> t b c d</span>
<span id="cb2-23"><a href="#cb2-23"></a>  <span class="dt">AddTopping</span> (<span class="dt">HamburgerC</span> a <span class="dt">Space</span> c d) t <span class="ot">=</span> <span class="dt">HamburgerC</span> a t c d</span>
<span id="cb2-24"><a href="#cb2-24"></a>  <span class="dt">AddTopping</span> (<span class="dt">HamburgerC</span> a b <span class="dt">Space</span> d) t <span class="ot">=</span> <span class="dt">HamburgerC</span> a b t d</span>
<span id="cb2-25"><a href="#cb2-25"></a>  <span class="dt">AddTopping</span> (<span class="dt">HamburgerC</span> a b c <span class="dt">Space</span>) t <span class="ot">=</span> <span class="dt">HamburgerC</span> a b c t</span>
<span id="cb2-26"><a href="#cb2-26"></a>  <span class="dt">AddTopping</span> _ _ <span class="ot">=</span> <span class="dt">Fail</span></span>
<span id="cb2-27"><a href="#cb2-27"></a></span>
<span id="cb2-28"><a href="#cb2-28"></a><span class="co">-- | A kind of the abstract hamburger</span></span>
<span id="cb2-29"><a href="#cb2-29"></a><span class="kw">data</span> <span class="dt">HamburgerT</span> <span class="ot">=</span> <span class="dt">HamburgerC</span> <span class="dt">Topping</span> <span class="dt">Topping</span> <span class="dt">Topping</span> <span class="dt">Topping</span> <span class="co">-- ^ A type constructor of the abstract hamburger</span></span>
<span id="cb2-30"><a href="#cb2-30"></a>                <span class="op">|</span> <span class="dt">Fail</span> <span class="co">-- ^ Mean a fail of a mapping of @AddTopping@</span></span>
<span id="cb2-31"><a href="#cb2-31"></a></span>
<span id="cb2-32"><a href="#cb2-32"></a></span>
<span id="cb2-33"><a href="#cb2-33"></a><span class="co">{- The dependent type -}</span></span>
<span id="cb2-34"><a href="#cb2-34"></a></span>
<span id="cb2-35"><a href="#cb2-35"></a><span class="co">-- |</span></span>
<span id="cb2-36"><a href="#cb2-36"></a><span class="co">-- A concrete of the hamburger</span></span>
<span id="cb2-37"><a href="#cb2-37"></a><span class="co">-- (A type constructor for a type of @HamburgerT@ kind).</span></span>
<span id="cb2-38"><a href="#cb2-38"></a><span class="kw">data</span> <span class="dt">SHamburger</span> (<span class="ot">h ::</span> <span class="dt">HamburgerT</span>) <span class="kw">where</span></span>
<span id="cb2-39"><a href="#cb2-39"></a>  <span class="dt">Concrete</span><span class="ot"> ::</span> <span class="dt">STopping</span> <span class="ot">-&gt;</span> <span class="dt">STopping</span> <span class="ot">-&gt;</span> <span class="dt">STopping</span> <span class="ot">-&gt;</span> <span class="dt">STopping</span> <span class="ot">-&gt;</span> <span class="dt">SHamburger</span> (<span class="dt">HamburgerC</span> a b c<span class="ot"> d ::</span> <span class="dt">HamburgerT</span>)</span>
<span id="cb2-40"><a href="#cb2-40"></a></span>
<span id="cb2-41"><a href="#cb2-41"></a><span class="co">-- | A singleton type for @Topping@ kind.</span></span>
<span id="cb2-42"><a href="#cb2-42"></a><span class="kw">data</span> <span class="dt">STopping</span> <span class="ot">=</span> <span class="dt">SSpace</span> <span class="op">|</span> <span class="dt">SCheese</span> <span class="op">|</span> <span class="dt">STomato</span> <span class="op">|</span> <span class="dt">SMeet</span> <span class="op">|</span> <span class="dt">SUshi</span></span>
<span id="cb2-43"><a href="#cb2-43"></a>  <span class="kw">deriving</span> (<span class="dt">Show</span>)</span>
<span id="cb2-44"><a href="#cb2-44"></a></span>
<span id="cb2-45"><a href="#cb2-45"></a><span class="co">-- | Represent the simply dependent type</span></span>
<span id="cb2-46"><a href="#cb2-46"></a><span class="kw">class</span> <span class="dt">Singleton</span> (<span class="ot">h ::</span> <span class="dt">HamburgerT</span>) <span class="kw">where</span></span>
<span id="cb2-47"><a href="#cb2-47"></a><span class="ot">  sing ::</span> <span class="dt">SHamburger</span> h</span>
<span id="cb2-48"><a href="#cb2-48"></a></span>
<span id="cb2-49"><a href="#cb2-49"></a></span>
<span id="cb2-50"><a href="#cb2-50"></a><span class="co">-- Define any instances for 126 patterns !</span></span>
<span id="cb2-51"><a href="#cb2-51"></a>defineInstances</span>
<span id="cb2-52"><a href="#cb2-52"></a></span>
<span id="cb2-53"><a href="#cb2-53"></a></span>
<span id="cb2-54"><a href="#cb2-54"></a><span class="kw">type</span> <span class="dt">BasicHamburgerC</span> <span class="ot">=</span> <span class="dt">HamburgerC</span> <span class="dt">Space</span> <span class="dt">Space</span> <span class="dt">Space</span> <span class="dt">Space</span></span>
<span id="cb2-55"><a href="#cb2-55"></a></span>
<span id="cb2-56"><a href="#cb2-56"></a><span class="kw">type</span> <span class="dt">HamburgerC1</span> <span class="ot">=</span> <span class="dt">AddTopping</span> <span class="dt">BasicHamburgerC</span> <span class="dt">Cheese</span> <span class="co">-- these kind is @HamburgerT@</span></span>
<span id="cb2-57"><a href="#cb2-57"></a><span class="kw">type</span> <span class="dt">HamburgerC2</span> <span class="ot">=</span> <span class="dt">AddTopping</span> <span class="dt">HamburgerC1</span> <span class="dt">Tomato</span></span>
<span id="cb2-58"><a href="#cb2-58"></a><span class="kw">type</span> <span class="dt">HamburgerC3</span> <span class="ot">=</span> <span class="dt">AddTopping</span> <span class="dt">HamburgerC2</span> <span class="dt">Meet</span></span>
<span id="cb2-59"><a href="#cb2-59"></a><span class="kw">type</span> <span class="dt">HamburgerC4</span> <span class="ot">=</span> <span class="dt">AddTopping</span> <span class="dt">HamburgerC3</span> <span class="dt">Ushi</span></span>
<span id="cb2-60"><a href="#cb2-60"></a><span class="kw">type</span> <span class="dt">HamburgerC5</span> <span class="ot">=</span> <span class="dt">AddTopping</span> <span class="dt">HamburgerC4</span> <span class="dt">Ushi</span> <span class="co">-- = Fail</span></span>
<span id="cb2-61"><a href="#cb2-61"></a></span>
<span id="cb2-62"><a href="#cb2-62"></a>x0 <span class="ot">= sing ::</span> <span class="dt">SHamburger</span> <span class="dt">BasicHamburgerC</span></span>
<span id="cb2-63"><a href="#cb2-63"></a>x1 <span class="ot">= sing ::</span> <span class="dt">SHamburger</span> <span class="dt">HamburgerC1</span></span>
<span id="cb2-64"><a href="#cb2-64"></a>x2 <span class="ot">= sing ::</span> <span class="dt">SHamburger</span> <span class="dt">HamburgerC2</span></span>
<span id="cb2-65"><a href="#cb2-65"></a>x3 <span class="ot">= sing ::</span> <span class="dt">SHamburger</span> <span class="dt">HamburgerC3</span></span>
<span id="cb2-66"><a href="#cb2-66"></a>x4 <span class="ot">= sing ::</span> <span class="dt">SHamburger</span> <span class="dt">HamburgerC4</span></span>
<span id="cb2-67"><a href="#cb2-67"></a><span class="co">--x5 = sing :: SHamburger HamburgerC5 -- This is the compile error because Refl is not a Fail's value</span></span>
<span id="cb2-68"><a href="#cb2-68"></a></span>
<span id="cb2-69"><a href="#cb2-69"></a></span>
<span id="cb2-70"><a href="#cb2-70"></a><span class="ot">main ::</span> <span class="dt">IO</span> ()</span>
<span id="cb2-71"><a href="#cb2-71"></a>main <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb2-72"><a href="#cb2-72"></a>  <span class="fu">print</span> x0</span>
<span id="cb2-73"><a href="#cb2-73"></a>  <span class="fu">print</span> x1</span>
<span id="cb2-74"><a href="#cb2-74"></a>  <span class="fu">print</span> x2</span>
<span id="cb2-75"><a href="#cb2-75"></a>  <span class="fu">print</span> x3</span>
<span id="cb2-76"><a href="#cb2-76"></a>  <span class="fu">print</span> x4</span></code></pre></div>
<!-- }}} -->
<!-- Hamburger/TH.hs {{{ -->
<ul>
<li><a href="https://github.com/aiya000/learning-Haskell/blob/d4d29ad26673e828bc0b0358d1cde42c295eb50b/Language/Haskell/Extension/Room/Hamburger/TH.hs">Hamburger/TH.hs</a></li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb3-1"><a href="#cb3-1"></a><span class="ot">{-# LANGUAGE TemplateHaskell #-}</span></span>
<span id="cb3-2"><a href="#cb3-2"></a></span>
<span id="cb3-3"><a href="#cb3-3"></a><span class="kw">module</span> <span class="dt">Hamburger.TH</span> <span class="kw">where</span></span>
<span id="cb3-4"><a href="#cb3-4"></a></span>
<span id="cb3-5"><a href="#cb3-5"></a><span class="kw">import</span> <span class="dt">Language.Haskell.TH</span> (<span class="dt">Type</span>(..), <span class="dt">Name</span>, mkName, <span class="dt">Exp</span>(..), <span class="dt">DecsQ</span>, <span class="dt">Dec</span>(..), <span class="dt">Clause</span>(..), <span class="dt">Pat</span>(..), <span class="dt">Body</span>(..), <span class="dt">Lit</span>(..))</span>
<span id="cb3-6"><a href="#cb3-6"></a></span>
<span id="cb3-7"><a href="#cb3-7"></a><span class="kw">type</span> <span class="dt">TypeName</span> <span class="ot">=</span> <span class="dt">String</span></span>
<span id="cb3-8"><a href="#cb3-8"></a></span>
<span id="cb3-9"><a href="#cb3-9"></a><span class="kw">type</span> <span class="dt">Topping4</span> <span class="ot">=</span> (<span class="dt">TypeName</span>, <span class="dt">TypeName</span>, <span class="dt">TypeName</span>, <span class="dt">TypeName</span>)</span>
<span id="cb3-10"><a href="#cb3-10"></a></span>
<span id="cb3-11"><a href="#cb3-11"></a></span>
<span id="cb3-12"><a href="#cb3-12"></a><span class="ot">topping4s ::</span> [<span class="dt">Topping4</span>]</span>
<span id="cb3-13"><a href="#cb3-13"></a>topping4s <span class="ot">=</span> [(w, x, y, z) <span class="op">|</span> w <span class="ot">&lt;-</span> toppings, x <span class="ot">&lt;-</span> toppings, y <span class="ot">&lt;-</span> toppings, z <span class="ot">&lt;-</span> toppings]</span>
<span id="cb3-14"><a href="#cb3-14"></a>  <span class="kw">where</span></span>
<span id="cb3-15"><a href="#cb3-15"></a><span class="ot">    toppings ::</span> [<span class="dt">TypeName</span>]</span>
<span id="cb3-16"><a href="#cb3-16"></a>    toppings <span class="ot">=</span> [<span class="st">&quot;Space&quot;</span>, <span class="st">&quot;Cheese&quot;</span>, <span class="st">&quot;Tomato&quot;</span>, <span class="st">&quot;Meet&quot;</span>, <span class="st">&quot;Ushi&quot;</span>]</span>
<span id="cb3-17"><a href="#cb3-17"></a></span>
<span id="cb3-18"><a href="#cb3-18"></a><span class="co">-- | Make a AST of @Type@ is like &quot;(HamburgerC Space Cheese Tomato Meet)&quot;</span></span>
<span id="cb3-19"><a href="#cb3-19"></a><span class="ot">hamburgerC ::</span> <span class="dt">Topping4</span> <span class="ot">-&gt;</span> <span class="dt">Type</span></span>
<span id="cb3-20"><a href="#cb3-20"></a>hamburgerC (w, x, y, z) <span class="ot">=</span> <span class="dt">ParensT</span> (<span class="dt">ConT</span> (mkName <span class="st">&quot;HamburgerC&quot;</span>) </span>
<span id="cb3-21"><a href="#cb3-21"></a>                            <span class="ot">`AppT`</span> <span class="dt">ConT</span> (mkName w)</span>
<span id="cb3-22"><a href="#cb3-22"></a>                            <span class="ot">`AppT`</span> <span class="dt">ConT</span> (mkName x)</span>
<span id="cb3-23"><a href="#cb3-23"></a>                            <span class="ot">`AppT`</span> <span class="dt">ConT</span> (mkName y)</span>
<span id="cb3-24"><a href="#cb3-24"></a>                            <span class="ot">`AppT`</span> <span class="dt">ConT</span> (mkName z))</span>
<span id="cb3-25"><a href="#cb3-25"></a></span>
<span id="cb3-26"><a href="#cb3-26"></a><span class="co">-- |</span></span>
<span id="cb3-27"><a href="#cb3-27"></a><span class="co">-- Make a AST of @Exp@ is like &quot;Concrete SSpace SCheese STomato SMeet&quot;</span></span>
<span id="cb3-28"><a href="#cb3-28"></a><span class="co">-- (@Topping4@ elements are added &quot;S&quot; prefix for @STopping@).</span></span>
<span id="cb3-29"><a href="#cb3-29"></a><span class="ot">concrete ::</span> <span class="dt">Topping4</span> <span class="ot">-&gt;</span> <span class="dt">Exp</span></span>
<span id="cb3-30"><a href="#cb3-30"></a>concrete (w, x, y, z) <span class="ot">=</span> <span class="dt">ConE</span> (mkName <span class="st">&quot;Concrete&quot;</span>)</span>
<span id="cb3-31"><a href="#cb3-31"></a>                 <span class="ot">`AppE`</span> <span class="dt">ConE</span> (mkName <span class="op">$</span> <span class="st">&quot;S&quot;</span> <span class="op">++</span> w)</span>
<span id="cb3-32"><a href="#cb3-32"></a>                 <span class="ot">`AppE`</span> <span class="dt">ConE</span> (mkName <span class="op">$</span> <span class="st">&quot;S&quot;</span> <span class="op">++</span> x)</span>
<span id="cb3-33"><a href="#cb3-33"></a>                 <span class="ot">`AppE`</span> <span class="dt">ConE</span> (mkName <span class="op">$</span> <span class="st">&quot;S&quot;</span> <span class="op">++</span> y)</span>
<span id="cb3-34"><a href="#cb3-34"></a>                 <span class="ot">`AppE`</span> <span class="dt">ConE</span> (mkName <span class="op">$</span> <span class="st">&quot;S&quot;</span> <span class="op">++</span> z)</span>
<span id="cb3-35"><a href="#cb3-35"></a></span>
<span id="cb3-36"><a href="#cb3-36"></a></span>
<span id="cb3-37"><a href="#cb3-37"></a><span class="co">-- | Define @Singleton@ instances and @Show@ instances for any pattern of @topping4@</span></span>
<span id="cb3-38"><a href="#cb3-38"></a><span class="ot">defineInstances ::</span> <span class="dt">DecsQ</span></span>
<span id="cb3-39"><a href="#cb3-39"></a>defineInstances <span class="ot">=</span> <span class="kw">do</span></span>
<span id="cb3-40"><a href="#cb3-40"></a>  <span class="kw">let</span> singletonInstances <span class="ot">=</span> <span class="fu">map</span> defineSingletonInstance topping4s</span>
<span id="cb3-41"><a href="#cb3-41"></a>      showInstances      <span class="ot">=</span> <span class="fu">map</span> defineShowInstance topping4s</span>
<span id="cb3-42"><a href="#cb3-42"></a>  <span class="fu">return</span> <span class="op">$</span> singletonInstances <span class="op">++</span> showInstances</span>
<span id="cb3-43"><a href="#cb3-43"></a>  <span class="kw">where</span></span>
<span id="cb3-44"><a href="#cb3-44"></a><span class="ot">    defineSingletonInstance ::</span> <span class="dt">Topping4</span> <span class="ot">-&gt;</span> <span class="dt">Dec</span></span>
<span id="cb3-45"><a href="#cb3-45"></a>    defineSingletonInstance t4<span class="op">@</span>(w, x, y, z) <span class="ot">=</span></span>
<span id="cb3-46"><a href="#cb3-46"></a>      <span class="dt">InstanceD</span> <span class="dt">Nothing</span> []</span>
<span id="cb3-47"><a href="#cb3-47"></a>        (<span class="dt">ConT</span> (mkName <span class="st">&quot;Singleton&quot;</span>) <span class="ot">`AppT`</span> hamburgerC t4)</span>
<span id="cb3-48"><a href="#cb3-48"></a>        [</span>
<span id="cb3-49"><a href="#cb3-49"></a>          <span class="dt">FunD</span> (mkName <span class="st">&quot;sing&quot;</span>) [<span class="dt">Clause</span> [] (<span class="dt">NormalB</span> <span class="op">$</span> concrete t4) []]</span>
<span id="cb3-50"><a href="#cb3-50"></a>        ]</span>
<span id="cb3-51"><a href="#cb3-51"></a></span>
<span id="cb3-52"><a href="#cb3-52"></a><span class="ot">    defineShowInstance ::</span> <span class="dt">Topping4</span> <span class="ot">-&gt;</span> <span class="dt">Dec</span></span>
<span id="cb3-53"><a href="#cb3-53"></a>    defineShowInstance t4<span class="op">@</span>(w, x, y, z) <span class="ot">=</span></span>
<span id="cb3-54"><a href="#cb3-54"></a>      <span class="dt">InstanceD</span> <span class="dt">Nothing</span> []</span>
<span id="cb3-55"><a href="#cb3-55"></a>        (<span class="dt">ConT</span> (mkName <span class="st">&quot;Show&quot;</span>) <span class="ot">`AppT`</span> <span class="dt">ParensT</span> (<span class="dt">ConT</span> (mkName <span class="st">&quot;SHamburger&quot;</span>) <span class="ot">`AppT`</span> hamburgerC t4))</span>
<span id="cb3-56"><a href="#cb3-56"></a>        [</span>
<span id="cb3-57"><a href="#cb3-57"></a>          <span class="dt">FunD</span> (mkName <span class="st">&quot;show&quot;</span>) [<span class="dt">Clause</span> [<span class="dt">WildP</span>] (<span class="dt">NormalB</span> <span class="op">$</span></span>
<span id="cb3-58"><a href="#cb3-58"></a>              (<span class="dt">LitE</span> <span class="op">.</span> <span class="dt">StringL</span> <span class="op">$</span> <span class="st">&quot;SHamburger (&quot;</span> <span class="op">++</span> w <span class="op">++</span> <span class="st">&quot; &quot;</span> <span class="op">++</span> x <span class="op">++</span> <span class="st">&quot; &quot;</span> <span class="op">++</span> y <span class="op">++</span> <span class="st">&quot; &quot;</span> <span class="op">++</span> z <span class="op">++</span> <span class="st">&quot;)&quot;</span>)</span>
<span id="cb3-59"><a href="#cb3-59"></a>          ) []]</span>
<span id="cb3-60"><a href="#cb3-60"></a>        ]</span></code></pre></div>
<!-- }}} -->
<h1 id="解説">解説</h1>
<h2 id="型レベルハンバーガーの目的主題">型レベルハンバーガーの目的、主題</h2>
<p>　型レベルハンバーガーは</p>
<ol type="1">
<li>5つ以上のトッピングを追加されると、例外ではなくコンパイルエラーで失敗を報告します</li>
<li>失敗していない有効なハンバーガーは、値として取得できます</li>
</ol>
<p>というのが目的（主題）です。 （2つ目のやつは後付け）</p>
<p>詳細にはこんな感じ。</p>
<ol type="1">
<li>5つ以上の<code>Topping</code>を追加されると（<code>x5</code>を介して）コンパイルエラーになります</li>
<li><code>Topping</code>の追加はTypeFamiliesの型関数<code>AddTopping</code>によって追加されます</li>
<li><code>Topping</code>の追加は種<code>HamburgerT</code>の型<code>Hamburger a b c d</code>に対して行われます
<ul>
<li><code>type family AddTopping (h :: HamburgerT) (t :: Topping) :: HamburgerT</code></li>
<li>（擬似的には<code>HamburgerT -&gt; Topping -&gt; HamburgerT</code>）</li>
</ul></li>
<li>種<code>HamburgerT</code>を持つ型のうち有効なもの（つまり<code>Fail</code>以外）は値レベルに降格できます
<ul>
<li>備考: 依存型って、値から型への昇格を扱うだけのものじゃなかったんだね</li>
</ul></li>
</ol>
<h2 id="型レベルハンバーガーの見どころ">型レベルハンバーガーの見どころ</h2>
<p>　これの見どころ（こだわりどころ）は、Hamburger.hsのトップレベルにある<code>x5</code>をコンパイルしようとすると、コンパイルエラーになるところです。<br />
それは、<code>x5</code>の型である<code>SHamburger HambergerC5</code>が<code>SHamburger Fail</code>であり （※<a href="../posts/2017-06-24-ghci-type-level-debug.html">:kind!</a>） <code>Fail</code>はHamburger.hsに定義されている型クラス<code>Singleton</code>のインスタンスではないからです。 （<code>sing</code>関数は<code>Singleton</code>の関数）</p>
<p>　以下の型の<code>Singleton</code>インスタンスは</p>
<ul>
<li><code>SHamburger BasicHamburgerC</code></li>
<li><code>SHamburger HamburgerC1</code></li>
<li><code>SHamburger HamburgerC2</code></li>
<li><code>SHamburger HamburgerC3</code></li>
<li><code>SHamburger HamburgerC4</code></li>
</ul>
<p>TemplateHaskellによってHamburger.hsのトップレベルで展開される<code>defineInstances</code>によって定義されます。 <code>defineInstances</code>はTH.hsによって提供されているメタ関数です。</p>
<h2 id="型レベルハンバーガーへのtoppingの追加">型レベルハンバーガーへのToppingの追加</h2>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">type</span> <span class="kw">family</span> <span class="dt">AddTopping</span> (<span class="ot">h ::</span> <span class="dt">HamburgerT</span>) (<span class="ot">t ::</span> <span class="dt">Topping</span>)<span class="ot"> ::</span> <span class="dt">HamburgerT</span> <span class="kw">where</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="dt">AddTopping</span> (<span class="dt">HamburgerC</span> <span class="dt">Space</span> b c d) t <span class="ot">=</span> <span class="dt">HamburgerC</span> t b c d</span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="dt">AddTopping</span> (<span class="dt">HamburgerC</span> a <span class="dt">Space</span> c d) t <span class="ot">=</span> <span class="dt">HamburgerC</span> a t c d</span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="dt">AddTopping</span> (<span class="dt">HamburgerC</span> a b <span class="dt">Space</span> d) t <span class="ot">=</span> <span class="dt">HamburgerC</span> a b t d</span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="dt">AddTopping</span> (<span class="dt">HamburgerC</span> a b c <span class="dt">Space</span>) t <span class="ot">=</span> <span class="dt">HamburgerC</span> a b c t</span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="dt">AddTopping</span> _ _ <span class="ot">=</span> <span class="dt">Fail</span></span></code></pre></div>
<p>　このパターンそのまんまですね、TypeFamiliesです。</p>
<h2 id="型レベルプログラミングを解決するためにtemplatehaskellを使うのは1回-回った感があるth.hsについて">型レベルプログラミングを解決するためにTemplateHaskellを使うのは1回 回った感がある（TH.hsについて）</h2>
<p>　TH.hsにある<code>defineInstances</code>は<code>SHamburger (HamburgerC a b c d :: HamburgerT)</code>の形をした126個の型の<code>Singleton</code>インスタンスを生成します。 （つまり<code>SHamburger (h :: HamburgerT)</code>のうち<code>Fail</code>以外に対する）</p>
<p>　<code>Singleton</code>は依存型（もどき？）を扱うためのものです。</p>
<p>　<a href="http://konn-san.com/prog/2013-advent-calendar.html">参考にしたページ</a>では自然数の帰納法を使ってインスタンスを実装してましたが、 依存型を使うことを考える前に考えた構造が全然帰納的でなかったので、TemplateHaskellを使って力技で解決しました。 （誰かうまい方法を教えてください！）</p>
<h2 id="値レベルハンバーガー">値レベルハンバーガー</h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">data</span> <span class="dt">SHamburger</span> (<span class="ot">h ::</span> <span class="dt">HamburgerT</span>) <span class="kw">where</span></span>
<span id="cb5-2"><a href="#cb5-2"></a>  <span class="dt">Concrete</span><span class="ot"> ::</span> <span class="dt">STopping</span> <span class="ot">-&gt;</span> <span class="dt">STopping</span> <span class="ot">-&gt;</span> <span class="dt">STopping</span> <span class="ot">-&gt;</span> <span class="dt">STopping</span> <span class="ot">-&gt;</span> <span class="dt">SHamburger</span> (<span class="dt">HamburgerC</span> a b c<span class="ot"> d ::</span> <span class="dt">HamburgerT</span>)</span>
<span id="cb5-3"><a href="#cb5-3"></a></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="kw">data</span> <span class="dt">STopping</span> <span class="ot">=</span> <span class="dt">SSpace</span> <span class="op">|</span> <span class="dt">SCheese</span> <span class="op">|</span> <span class="dt">STomato</span> <span class="op">|</span> <span class="dt">SMeet</span> <span class="op">|</span> <span class="dt">SUshi</span></span>
<span id="cb5-5"><a href="#cb5-5"></a>  <span class="kw">deriving</span> (<span class="dt">Show</span>)</span></code></pre></div>
<p>　各<code>Singleton</code>インスタンス実装は<code>defineInstances</code>が行うので具体的なコードはありませんが、このようなものになります。</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span id="cb6-1"><a href="#cb6-1"></a><span class="kw">instance</span> <span class="dt">Singleton</span> (<span class="dt">HamburgerC</span> <span class="dt">Cheese</span> <span class="dt">Ushi</span> <span class="dt">Meet</span> <span class="dt">Space</span>) <span class="kw">where</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>  sing <span class="ot">=</span> <span class="dt">Concrete</span> <span class="dt">SCheese</span> <span class="dt">SUshi</span> <span class="dt">SMeet</span> <span class="dt">SSpace</span></span></code></pre></div>
<p>　Haskellでは依存型は実際には使えないらしいので、インスタンスになる型と<code>sing</code>（の具体値）はこのような一対一対応になります。</p>
<pre><code>型レベル: HamburgerC Cheese Ushi Meet Space
値レベル: Concrete SCheese SUshi SMeet SSpace</code></pre>
<p><code>HamburgerC</code>に<code>Cheese Ushi Meet Space</code>が指定されれば、その値は<code>Concrete</code>と<code>SCheese SUshi SMeet SSpace</code>に限り<br />
その逆もまた同じく限る感じです。</p>
<p>一意的ってことですね。</p>
<h2 id="ということで">ということで</h2>
<p>　進捗報告はこんな感じでした <span class="emoji" data-emoji="dog2">🐕</span></p>
<h1 id="元ネタ">元ネタ</h1>
<blockquote class="twitter-tweet" data-lang="ja">
<p lang="ja" dir="ltr">
@ U科各位<br><br>Java課題ソースコード<a href="https://t.co/NOUtZAxB44">https://t.co/NOUtZAxB44</a>
</p>
— 焼きそばメロンパン@🍣 (<span class="citation" data-cites="ice_arr">@ice_arr</span>) <a href="https://twitter.com/ice_arr/status/876673209575251968">2017年6月19日</a>
</blockquote>
<script async src="//platform.twitter.com/widgets.js" charset="utf-8"></script>
<h1 id="参考">参考</h1>
<ul>
<li><a href="http://konn-san.com/prog/2013-advent-calendar.html">定理証明系 Haskell - konn-san.com</a></li>
</ul>
<h1 id="special-thanks">Special Thanks !</h1>
<ul>
<li><a href="https://github.com/aiya000/learning-Haskell/pull/1">Type Level Humberger by Hexirp · Pull Request #1 · aiya000/learning-Haskell · GitHub</a>
<ul>
<li>and Haskell-jp members !</li>
</ul></li>
<li>僕がTemplateHaskellによって何個のインスタンスを生成したのかをRubyインタプリタで調べてくれたぶらっきぃくん</li>
</ul>

    <hr />

    <ul class="bookmarkers">
        <li> <!-- See https://about.twitter.com/ja/resources/buttons -->
            <a href="https://twitter.com/share" class="twitter-share-button" data-via="public_ai000ya" data-size="small">Tweet</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </li>

        <li> <!-- See http://b.hatena.ne.jp/guide/bbutton -->
            <a href="http://b.hatena.ne.jp/entry/aiya000.github.io/posts/2017-06-26-typelevel-programming-dependent-type-template-haskell.html" class="hatena-bookmark-button" data-hatena-bookmark-title="型レベルハンバーガーについての報告 - あいや☆ぱぶりっしゅぶろぐ！" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
            <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
        </li>

        <li> <!-- See https://developers.facebook.com/docs/plugins/like-button?locale=ja_JP#configurator -->
            <div class="fb-like" data-href="https://aiya000.github.io/posts/2017-06-26-typelevel-programming-dependent-type-template-haskell.html" data-layout="button_count" data-action="like" data-size="small" data-show-faces="false" data-share="true"></div>
        </li>

        <li> <!-- See https://getpocket.com/publisher/button -->
            <a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="ja"></a>
            <script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>
        </li>
    </ul>

    <p class="about-pr">
        この記事はこちらから修正リクエストを送ることができます。 <br />
        <a href="https://github.com/aiya000/aiya000.github.io/blob/src/posts/2017-06-26-typelevel-programming-dependent-type-template-haskell.md">型レベルハンバーガーについての報告 - github</a> <br />
        ゴミ箱ボタンの左にある、鉛筆ボタンを押してね！
    </p>
</div>

<script src="../js/facebook-sdk-2.8.js"></script>


    <div class="footer">
      (*^o^) { This blog powerd by Haskell <a href="http://jaspervdj.be/hakyll">Hakyll</a>,
      and more (<a href="../licenses.html">about licenses</a>).
    </div>

    <script type="text/javascript" src="../node_modules/jquery/dist/jquery.slim.min.js"></script>
    <script type="text/javascript" src="../node_modules/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="../js/fontawesome-all.min.js"></script>
    <script type="text/javascript" src="../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
