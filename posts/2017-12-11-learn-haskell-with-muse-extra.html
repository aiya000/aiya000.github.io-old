<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>あいや☆ぱぶりっしゅぶろぐ！ - にこ、希と一緒に学ぶHaskell（番外）「ありふれたGHC拡張の紹介」</title>
        <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/highlight.css" />
        <!-- bootstrap requires jquery -->
        <script type="text/javascript" src="../js/jquery-3.1.1.min.js"></script>
        <script type="text/javascript" src="../js/bootstrap.min.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default">
            <div class="navbar-header">
                <a class="navbar-brand" href="../">あいや☆ぱぶりっしゅぶろぐ！</a>
            </div>
            <ul class="nav navbar-nav">
                <li><a href="../">Home</a></li>
                <li><a href="../about.html">About</a></li>
                <li><a href="../profile.html">Profile</a></li>
                <li><a href="../products.html">Products</a></li>
                <li><a href="../archive.html">Archive</a></li>
            </ul>
        </nav>

        <div id="content">
            <h4>にこ、希と一緒に学ぶHaskell（番外）「ありふれたGHC拡張の紹介」</h4>
            <link rel="stylesheet" type="text/css" href="../css/post.css" />

<div class="info">
    Posted on 2017/12/11 <br />
    

    Tags:
    
        [<a href="../tags/ラブライブ！で学ぶ.html">ラブライブ！で学ぶ</a>]
    
        [<a href="../tags/にこ、希と一緒に学ぶHaskell.html">にこ、希と一緒に学ぶHaskell</a>]
    
        [<a href="../tags/Haskell.html">Haskell</a>]
    

    <ul class="bookmarkers">
        <li> <!-- See https://about.twitter.com/ja/resources/buttons -->
            <a href="https://twitter.com/share" class="twitter-share-button" data-via="public_ai000ya" data-size="small">Tweet</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </li>

        <li> <!-- See http://b.hatena.ne.jp/guide/bbutton -->
            <a href="http://b.hatena.ne.jp/entry/aiya000.github.io/posts/2017-12-11-learn-haskell-with-muse-extra.html" class="hatena-bookmark-button" data-hatena-bookmark-title="にこ、希と一緒に学ぶHaskell（番外）「ありふれたGHC拡張の紹介」 - あいや☆ぱぶりっしゅぶろぐ！" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
            <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
        </li>

        <li> <!-- See https://developers.facebook.com/docs/plugins/like-button?locale=ja_JP#configurator -->
            <div class="fb-like" data-href="https://aiya000.github.io/posts/2017-12-11-learn-haskell-with-muse-extra.html" data-layout="button_count" data-action="like" data-size="small" data-show-faces="false" data-share="true"></div>
        </li>

        <li> <!-- See https://getpocket.com/publisher/button -->
            <a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="ja"></a>
            <script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>
        </li>
    </ul>
</div>

<hr />

<ul>
<li><a href="../tags/ことり、穂乃果と一緒に学ぶHaskell.html">記事一覧 - ことり、穂乃果と一緒に学ぶHaskell（入門）</a></li>
<li><a href="../tags/にこ、希と一緒に学ぶHaskell.html">記事一覧 - にこ、希と一緒に学ぶHaskell（番外）</a></li>
<li><a href="https://github.com/aiya000/aiya000.github.io/search?utf8=%E2%9C%93&amp;q=%22Haskell%2FMuse%3A%22&amp;type=Commits">更新履歴 - μ’sと一緒に学ぶHaskell</a></li>
</ul>
<h1 id="今日は">今日は</h1>
<p>希「やっほーにこっち！」<br />
にこ「こんにちは、希」</p>
<p>希「うち、この前、GHCの<code>DataKinds</code>拡張やら<code>PolyKinds</code>やらを必要に駆られて使ったんやけど、 GHC拡張っていっぱいあるんやね！」<br />
にこ「そうねー、Haskell reportに『実験的な機能を取り入れた、この言語の拡張や 変形の出現はのぞむところである。』 って書いてあるくらいだしね」</p>
<ul>
<li><a href="http://www.sampou.org/haskell/report-revised-j/preface-jfp.html">Haskell98レポート - あらすじ</a>
<ul>
<li>あらすじ &gt; 言語とライブラリ</li>
</ul></li>
<li><a href="https://www.haskell.org/onlinereport/preface-jfp.html">The Haskell 98 Report - Preface</a></li>
</ul>
<p>希「そうそう。 　そんでな、おのれの興味にしたがって、いくらかのGHC拡張をノートにまとめてきたんよ。」<br />
希「にこっち。 　うちの解釈がちゃんと合ってるか、一緒に確認してくれへん？」<br />
にこ「もちろんいいわよ！ 　Haskellならにこにまかせなさい！」</p>
<h1 id="flexibleinstances">FlexibleInstances</h1>
<p>希「最初やし、まずはゆるい感じのとこからいかせてもらうわ」<br />
希「<code>FlexibleInstances</code>、これは型クラスに対して、ある高階型の<strong>部分的な</strong>インスタンスを定義できる拡張やんね」<br />
希「部分的っちゅうのは……こんな感じ！」</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE FlexibleInstances #-}</span>

<span class="kw">class</span> <span class="dt">Identical</span> a <span class="kw">where</span>
<span class="ot">  id' ::</span> a <span class="ot">-&gt;</span> a
  id' <span class="fu">=</span> id

<span class="kw">data</span> <span class="dt">Foo</span> a <span class="fu">=</span> <span class="dt">Foo</span>
  <span class="kw">deriving</span> (<span class="dt">Show</span>)

<span class="co">-- 部分的なインスタンス</span>
<span class="kw">instance</span> <span class="dt">Identical</span> (<span class="dt">Foo</span> <span class="dt">Int</span>)

<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> <span class="kw">do</span>
  print <span class="fu">$</span> id' (<span class="dt">Foo</span><span class="ot"> ::</span> <span class="dt">Foo</span> <span class="dt">Int</span>)
  <span class="co">--print $ id' (Foo :: Foo Char) -- 未定義のインスタンス</span></code></pre></div>
<p>希「<code>FlexibleInstances</code>拡張を外してこれをコンパイルすると、こんなエラーが出たで」</p>
<pre><code>• Illegal instance declaration for ‘Identical (Foo Int)’
    (All instance types must be of the form (T a1 ... an)
     where a1 ... an are *distinct type variables*,
     and each type variable appears at most once in the instance head.
     Use FlexibleInstances if you want to disable this.)
• In the instance declaration for ‘Identical (Foo Int)’</code></pre>
<p>希「つまり、<code>Foo a</code>やのうて、<code>Int</code>に固定された<code>Foo Int</code>の型クラスインスタンスを書けるってことやんね？」<br />
にこ「そうね！ 　通常は任意の<code>Foo a</code>のインスタンスを書くことが要請されるから、 任意の<code>a</code>に対してインスタンスを書きたくない場合とか、 書けない場合に使えるわね」</p>
<h1 id="flexiblecontexts">FlexibleContexts</h1>
<p>希「<code>FlexibleContexts</code>、これは型制約の一部に具体型を指定できるやつやんね♪」<br />
にこ「そうそう！　格好いいわよねこれ」<br />
希「わかるわ〜」</p>
<p>希「例えば<code>Coercible</code>の型制約をこんな感じに書けるようになる」</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE FlexibleContexts #-}</span>

<span class="kw">import </span><span class="dt">GHC.Prim</span> (coerce)
<span class="kw">import </span><span class="dt">GHC.Types</span> (<span class="dt">Coercible</span>)

toInt<span class="ot"> ::</span> <span class="dt">Coercible</span> a <span class="dt">Int</span> <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">Int</span>
toInt <span class="fu">=</span> coerce

<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> return ()</code></pre></div>
<p>希「これを外したときのコンパイルエラーはこんなやったで」</p>
<pre><code>• Non type-variable argument in the constraint: Coercible * a Int
  (Use FlexibleContexts to permit this)
• In the type signature:
    toInt :: Coercible a Int =&gt; a -&gt; Int</code></pre>
<p>希「ところで、なんや<code>Coercible * a Int</code>っていう、 見慣れない<code>*</code>が出てきたんやけど、これはなんやの？」</p>
<p>にこ「ああこれは、<code>a :: *</code>の<code>*</code>ね」<br />
希「ああ、なんか<code>PolyKinds</code>つこうたときに、よう見た気がするわ〜」</p>
<p>にこ「多分それを実行するときに、ghcコマンドのオプションなんかに<code>-fprint-explicit-kinds</code>がついてたんじゃないかしら？」</p>
<h1 id="datakinds">DataKinds</h1>
<p>希「うち、コレスキヤワ〜〜」<br />
にこ「わかりもうす」</p>
<p>希「ある型をカインドとして、その値をデータ型として使えるようにするやん」<br />
希「具体的には以下のように、型のリストを作ったりできる」</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">{-# LANGUAGE DataKinds #-}</span>

<span class="co">-- X :: [*]</span>
<span class="kw">type</span> <span class="dt">X</span> <span class="fu">=</span> <span class="ch">'[Int, Char]</span>

<span class="kw">data</span> <span class="dt">AKind</span> <span class="fu">=</span> <span class="dt">TypeX</span> <span class="fu">|</span> <span class="dt">TypeY</span>

<span class="co">-- Y :: [AKind]</span>
<span class="kw">type</span> <span class="dt">Y</span> <span class="fu">=</span> <span class="ch">'[TypeX, TypeY]</span>

<span class="kw">data</span> <span class="dt">ContainerKind</span> a <span class="fu">=</span> <span class="dt">Container</span> a

<span class="co">-- Z :: ContainerKind *</span>
<span class="kw">type</span> <span class="dt">Z</span> <span class="fu">=</span> <span class="dt">Container</span> <span class="dt">Int</span>

<span class="co">-- Z' :: ContainerKind AKind</span>
<span class="kw">type</span> <span class="dt">Z'</span> <span class="fu">=</span> <span class="dt">Container</span> <span class="dt">TypeX</span>

<span class="ot">main ::</span> <span class="dt">IO</span> ()
main <span class="fu">=</span> return ()</code></pre></div>

<hr />
<hr />

<p class="about-pr">
この記事はこちらから修正リクエストを送ることができます。 <br />
<a href="https://github.com/aiya000/aiya000.github.io/blob/src/posts/2017-12-11-learn-haskell-with-muse-extra.md">にこ、希と一緒に学ぶHaskell（番外）「ありふれたGHC拡張の紹介」 - github</a> <br />
ゴミ箱ボタンの左にある、鉛筆ボタンを押してね！
</p>

<script src="../js/facebook-sdk-2.8.js"></script>

        </div>

        <div id="footer">
            (*^o^) { This blog powerd by Haskell <a href="http://jaspervdj.be/hakyll">Hakyll</a> <br />
            and Uses <a href="http://nkmr6194.github.io/Umi/">Umi</a>
        </div>
    </body>
</html>
