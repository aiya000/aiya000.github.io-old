<!-- htmlhint id-class-value:false / avoid the warnings to bootstrap names -->

<html>
    <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# website: http://ogp.me/ns/website#">
        <title>galaxy-sixth-sensey - にこ、希と一緒に学ぶHaskell（番外）「あまり知られていないGHC拡張の紹介」</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta property="og:url" content="https://aiya000.github.io" />
        <meta property="og:type" content="website" />
        <meta property="og:title" content="galaxy-sixth-sensey - にこ、希と一緒に学ぶHaskell（番外）「あまり知られていないGHC拡張の紹介」" />
        <meta property="og:description" content="ギャラクシー・シックス・センスワイ - プログラミング・数学・一次創作" />
        <meta property="og:site_name" content="galaxy-sixth-sensey" />
        <meta property="og:image" content="https://aiya000.github.io/images/mu-icon.png" />
        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:site" content="@public_ai000ya" />
        <meta name="twitter:creator" content="@public_ai000ya">
        <meta name="twitter:title" content="galaxy-sixth-sensey - にこ、希と一緒に学ぶHaskell（番外）「あまり知られていないGHC拡張の紹介」" />
        <meta name="twitter:description" content="ギャラクシー・シックス・センスワイ - プログラミング・数学・一次創作" />
        <meta name="twitter:image" content="https://aiya000.github.io/images/ogp-twitter-card-large.png" />
        <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/highlight.js/atom-one-dark.css" />
    </head>
    <body>
        <nav class="navbar navbar-expand-lg navbar-light bg-light">
            <a class="navbar-brand" href="../">
                galaxy-sixth-sensey
            </a>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="../">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../about.html">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../profile.html">Profile</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../products.html">Products</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="../archive.html">Archive</a>
                    </li>
                </ul>
            </div>
        </nav>

        <link rel="stylesheet" type="text/css" href="../css/post.css" />

<head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# article: http://ogp.me/ns/article#">
    <title>galaxy-sixth-sensey - にこ、希と一緒に学ぶHaskell（番外）「あまり知られていないGHC拡張の紹介」</title>
    <meta property="og:url" content="https://aiya000.github.io/posts/2017-12-25-learn-haskell-with-muse-extra.html" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="galaxy-sixth-sensey - にこ、希と一緒に学ぶHaskell（番外）「あまり知られていないGHC拡張の紹介」" />
    <meta property="og:description" content="にこ、希と一緒に学ぶHaskell（番外）「あまり知られていないGHC拡張の紹介」" />
    <meta property="og:site_name" content="galaxy-sixth-sensey" />
    <meta property="og:image" content="https://aiya000.github.io/images/mu-icon.png" />
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@public_ai000ya" />
    <meta name="twitter:creator" content="@public_ai000ya">
    <meta name="twitter:title" content="galaxy-sixth-sensey - にこ、希と一緒に学ぶHaskell（番外）「あまり知られていないGHC拡張の紹介」" />
    <meta name="twitter:description" content="にこ、希と一緒に学ぶHaskell（番外）「あまり知られていないGHC拡張の紹介」" />
    <meta name="twitter:image" content="https://aiya000.github.io/images/mu-icon.png" />
</head>

<div class="post-info">
    <div class="post-date">2017/12/25</div>
    

    <div class="post-title">にこ、希と一緒に学ぶHaskell（番外）「あまり知られていないGHC拡張の紹介」</div>

    <ul class="post-tags">
        
            <li>
                <i class="fas fa-tag"></i>
                <a href="../tags/ラブライブ！で学ぶ.html">ラブライブ！で学ぶ</a>
            </li>
        
            <li>
                <i class="fas fa-tag"></i>
                <a href="../tags/にこ、希と一緒に学ぶHaskell.html">にこ、希と一緒に学ぶHaskell</a>
            </li>
        
            <li>
                <i class="fas fa-tag"></i>
                <a href="../tags/Haskell.html">Haskell</a>
            </li>
        
            <li>
                <i class="fas fa-tag"></i>
                <a href="../tags/AdventCalendar2017.html">AdventCalendar2017</a>
            </li>
        
            <li>
                <i class="fas fa-tag"></i>
                <a href="../tags/AdventCalendar.html">AdventCalendar</a>
            </li>
        
    </ul>
</div>

<div class="post-body">
    <p>　この記事は<a href="https://qiita.com/advent-calendar/2017/haskell3">Haskell (その3） Advent Calendar 2017</a>の 21日目の記事です！</p>
<p>　この記事にはSS表現、ラブライブが含まれます。 これらが苦手な方はブラウザバックを推奨します。</p>
<hr />
<ul>
<li><a href="../tags/ことり、穂乃果と一緒に学ぶHaskell.html">記事一覧 - ことり、穂乃果と一緒に学ぶHaskell（入門）</a></li>
<li><a href="../tags/にこ、希と一緒に学ぶHaskell.html">記事一覧 - にこ、希と一緒に学ぶHaskell（番外）</a></li>
<li><a href="https://github.com/aiya000/aiya000.github.io/search?utf8=%E2%9C%93&amp;q=%22Haskell%2FMuse%3A%22&amp;type=Commits">更新履歴 - μ’sと一緒に学ぶHaskell</a></li>
</ul>
<h1 id="outline">Outline</h1>
<ul>
<li><a href="#multiparamtypeclasses">MultiParamTypeClasses</a></li>
<li><a href="#constrainedclassmethods">ConstrainedClassMethods</a></li>
<li><a href="#rebindablesyntax">RebindableSyntax</a>
<ul>
<li><a href="#noimplicitprelude%E8%A3%9C%E8%B6%B3">NoImplicitPrelude（補足）</a></li>
</ul></li>
<li><a href="#instancesigs">InstanceSigs</a></li>
<li><a href="#impredicativetypes">ImpredicativeTypes</a></li>
<li><a href="#explicitnamespaces">ExplicitNamespaces</a></li>
<li><a href="#%E5%8F%82%E8%80%83%E3%83%9A%E3%83%BC%E3%82%B8">参考ページ</a></li>
</ul>
<h1 id="前回の型ライブ">前回の型ライブ！</h1>
<p>放課後、部室に集まって、よく知られたGHC拡張について語り合う にこっち と うち。</p>
<p>希「GHC拡張っていっぱいあるんやね！」<br />
にこ「Haskell reportに『実験的な機能を取り入れた、この言語の拡張や 変形の出現はのぞむところである。』って書いてあるくらいだしね」</p>
<p>調べれば調べるほど出てくるGHC拡張に対して、改めて全能感を感じる。<br />
でも、Haskellの力はまだまだこんなもんやない。</p>
<p>そんな充実感を抱きながらお風呂から上がると、うちのGoogleHangoutに、謎のビデオ電話がかかってきた！</p>
<h1 id="にこののぞみ">にこののぞみ</h1>
<p>希「はい、もしもし」<br />
にこ「こんばんは、希」<br />
希「にこっちやん。どうしたの？」</p>
<p>にこ「そのね、今日は珍しくママ……じゃなくてっ！」</p>
<p>にこ「お母さんが早く帰ってきてて、チビたちの面倒を見てくれてるから暇なんだけど、 Haskellのリモート勉強会しない？ ……なんて。」<br />
希「おっ、ええやん！ うちも実は、今ひまやったんよ」</p>
<p>にこ「そ、そう！ じゃ、じゃあ…… 放課後だけじゃあんまり語り尽くせなかったし、 またGHC拡張について話さない？」</p>
<p>希「いいね！ 実はさっき面白いページ見つけてな。 知らないGHC拡張がいっぱいあったんよ。 これ見ていくの、どうやろ？」</p>
<ul>
<li><a href="https://github.com/shiatsumat/wiwinwlh-jp/wiki/%E8%A8%80%E8%AA%9E%E6%8B%A1%E5%BC%B5">面白いページ -&gt; 言語拡張 - shiatsumat/wiwinwlh-jp Wiki - GitHub</a></li>
</ul>
<p>にこ「ええ、いいわねっ」</p>
<h1 id="multiparamtypeclasses">MultiParamTypeClasses</h1>
<p>希「さっき見つけたのが面白いのがあるんよ」</p>
<p>希「<code>MultiParamTypeClasses</code>については、にこっち多分知っとると思うんやけど」<br />
にこ「ええ」<br />
希「これって、0個の型に対するインスタンスも定義できるらしいやね」</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" title="1"><span class="ot">{-# LANGUAGE MultiParamTypeClasses #-}</span></a>
<a class="sourceLine" id="cb1-2" title="2"></a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">class</span> <span class="dt">Nullary</span></a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">instance</span> <span class="dt">Nullary</span></a>
<a class="sourceLine" id="cb1-5" title="5"></a>
<a class="sourceLine" id="cb1-6" title="6"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb1-7" title="7">main <span class="ot">=</span> <span class="fu">return</span> ()</a></code></pre></div>
<p>にこ「！？ 型クラスの受け取る型を、1個以上…… じゃなくて0個以上として一般化する拡張だったのね……」</p>
<p>にこ「これ、何にどうやって使うのかしら」<br />
希「うーん、わからへん……」</p>
<h1 id="constrainedclassmethods">ConstrainedClassMethods</h1>
<p>にこ「なにこれ、しらないわ」<br />
希「型クラスの関数に、型制約を設けることができるようになるみたいやね」</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" title="1"><span class="ot">{-# LANGUAGE ConstrainedClassMethods #-}</span></a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3"><span class="kw">class</span> <span class="dt">UnitedConvertible</span> a <span class="kw">where</span></a>
<a class="sourceLine" id="cb2-4" title="4"><span class="ot">  toItself ::</span> a <span class="ot">-&gt;</span> a</a>
<a class="sourceLine" id="cb2-5" title="5">  <span class="co">-- ConstrainedClassMethods allows to restrict constraints in the type class function</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="ot">  toString ::</span> <span class="dt">Show</span> a <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb2-7" title="7"></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb2-9" title="9">main <span class="ot">=</span> <span class="fu">return</span> ()</a></code></pre></div>
<p>希「Haskell98は型クラス関数に型制約を設けることを禁止してるらしくって」<br />
希「それの回避策らしいみたい。 Haskell98がそれを禁止してるの、なんでやろな？」<br />
にこ「Haskell reportは実装に言及しないらしいし、実装都合じゃあなさそうね。 なんでかしら」</p>
<p>にこ「ていうか、型クラスの関数って、型制約付けられなかったのね。 型クラス関数に他の型クラスの制約をつけることなんてあまりないものね……」</p>
<h1 id="rebindablesyntax">RebindableSyntax</h1>
<p>にこ「名前からして面白そうね」<br />
希「やね！ふむふむこれは…… Haskel reportでは以下の変換規則が規定されているらしいんやけど」</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" title="1"><span class="dv">1</span></a>
<a class="sourceLine" id="cb3-2" title="2">↓</a>
<a class="sourceLine" id="cb3-3" title="3">Prelude.fromInteger (<span class="dv">1</span><span class="ot"> ::</span> <span class="dt">Integer</span>)</a></code></pre></div>
<p>希「それを以下の変換規則に付け替えるんやって。」</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" title="1"><span class="dv">1</span></a>
<a class="sourceLine" id="cb4-2" title="2">↓</a>
<a class="sourceLine" id="cb4-3" title="3"><span class="fu">fromInteger</span> (<span class="dv">1</span><span class="ot"> ::</span> <span class="dt">Integer</span>)</a></code></pre></div>
<p>にこ「ふむふむ、Preludeの定義を参照はずのものを、ローカルの定義への参照に変えられるのね」</p>
<p>にこ「うわっ、<code>putStrLn 1</code>式を合法にできた……」</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" title="1"><span class="ot">{-# LANGUAGE RebindableSyntax #-}</span></a>
<a class="sourceLine" id="cb5-2" title="2"></a>
<a class="sourceLine" id="cb5-3" title="3"><span class="co">-- RebindableSyntax turns on NoImplicitPrelude</span></a>
<a class="sourceLine" id="cb5-4" title="4"><span class="kw">import</span> <span class="dt">Prelude</span> <span class="kw">hiding</span> (fromInteger)</a>
<a class="sourceLine" id="cb5-5" title="5"></a>
<a class="sourceLine" id="cb5-6" title="6"><span class="co">-- In the Haskell report specification,</span></a>
<a class="sourceLine" id="cb5-7" title="7"><span class="co">-- a literal `1` is expanded to `Prelude.fromInteger (1 :: Integer)`.</span></a>
<a class="sourceLine" id="cb5-8" title="8"><span class="co">--</span></a>
<a class="sourceLine" id="cb5-9" title="9"><span class="co">-- RebindableSyntax changes it to that is expanded to `fromInteger (1 :: Integer)`,</span></a>
<a class="sourceLine" id="cb5-10" title="10"><span class="co">-- also it means `1`'s convertion is able to rebind.</span></a>
<a class="sourceLine" id="cb5-11" title="11"><span class="fu">fromInteger</span><span class="ot"> ::</span> <span class="dt">Integer</span> <span class="ot">-&gt;</span> <span class="dt">String</span></a>
<a class="sourceLine" id="cb5-12" title="12"><span class="fu">fromInteger</span> _ <span class="ot">=</span> <span class="st">&quot;;P&quot;</span></a>
<a class="sourceLine" id="cb5-13" title="13"></a>
<a class="sourceLine" id="cb5-14" title="14"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb5-15" title="15">main <span class="ot">=</span> <span class="fu">putStrLn</span> <span class="dv">1</span></a>
<a class="sourceLine" id="cb5-16" title="16"><span class="co">-- {output}</span></a>
<a class="sourceLine" id="cb5-17" title="17"><span class="co">-- ;P</span></a></code></pre></div>
<p>希「<code>putStrLn 1</code>、字面がすごいわ……。 ああこれ、<code>NoImplicitPrelude</code>も有効になるんね」</p>
<p>希「他にはこんな変換規則を付け替えられるみたいやね」</p>
<table class="table table-bordered">
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>252.52</code></td>
<td style="text-align: left;"><code>Prelude.fromRational (252.52 :: Rational)</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>x == y</code></td>
<td style="text-align: left;"><code>x Prelude.== y</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>x - y</code></td>
<td style="text-align: left;"><code>x Prelude.- y</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>x &gt;= y</code></td>
<td style="text-align: left;"><code>x Prelude.&gt;= y</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>- x</code></td>
<td style="text-align: left;"><code>negate x</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>if x then y else z</code></td>
<td style="text-align: left;"><code>ifThenElse x y z</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>#nozo</code> (if <code>OverloadedLabels</code> is used)</td>
<td style="text-align: left;"><code>fromLabel @ "nozo"</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">リスト色々</td>
<td style="text-align: left;"><a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#overloaded-lists">OverloadedLists - GHC User’s Guide</a></td>
</tr>
</tbody>
</table>
<p>希「あとは<code>do</code>, <code>mdo</code>, リスト内包記と<code>Arrows</code>についても変換規則があるみたいやけど、明記はされてないんね。 <code>do</code>は多分こんな感じかなあ。 本当は多分パターンマッチまで考慮してそうやね」</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">do</span></a>
<a class="sourceLine" id="cb6-2" title="2">  x' <span class="ot">&lt;-</span> x</a>
<a class="sourceLine" id="cb6-3" title="3">  y</a>
<a class="sourceLine" id="cb6-4" title="4">  z</a>
<a class="sourceLine" id="cb6-5" title="5">↓</a>
<a class="sourceLine" id="cb6-6" title="6">x <span class="op">Prelude.&gt;&gt;=</span> \x' <span class="ot">-&gt;</span></a>
<a class="sourceLine" id="cb6-7" title="7">y <span class="op">Prelude.&gt;&gt;</span> z</a></code></pre></div>
<ul>
<li><a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#rebindable-syntax-and-the-implicit-prelude-import">10.3.15. Rebindable syntax and the implicit Prelude import - 10.1. Language options - Glasgow Haskell Compiler 8.2.2 User’s Guide</a></li>
</ul>
<h2 id="noimplicitprelude補足">NoImplicitPrelude（補足）</h2>
<ul>
<li><a href="https://wiki.haskell.org/No_import_of_Prelude">No import of Prelude - HaskellWiki</a></li>
</ul>
<p>にこ・希（読んでの通り、暗黙的に<code>import Prelude</code>を行わないための拡張。 これを指定しない限り、GHCは暗黙的にそれを行う）</p>
<h1 id="instancesigs">InstanceSigs</h1>
<p>にこ「これは、インスタンスを定義するときに、型クラスの関数の具体的シグネチャをインスタンス側で書けるやつね」<br />
希「さすがにこっちやね、知っとったか」</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" title="1"><span class="ot">{-# LANGUAGE InstanceSigs #-}</span></a>
<a class="sourceLine" id="cb7-2" title="2"></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="kw">class</span> <span class="dt">Identical</span> a <span class="kw">where</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="ot">  id' ::</span> a <span class="ot">-&gt;</span> a</a>
<a class="sourceLine" id="cb7-5" title="5"></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="kw">instance</span> <span class="dt">Identical</span> <span class="dt">Int</span> <span class="kw">where</span></a>
<a class="sourceLine" id="cb7-7" title="7">  <span class="co">-- InstanceSigs allows this type declaration</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="ot">  id' ::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb7-9" title="9">  id' <span class="ot">=</span> <span class="fu">id</span></a>
<a class="sourceLine" id="cb7-10" title="10"></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb7-12" title="12">main <span class="ot">=</span> <span class="fu">return</span> ()</a></code></pre></div>
<p>にこ「ええ。 インスタンス側の型クラス関数が、そのときに使いたい型になっているか不安なときに使ったりするわ。 <code>ScopedTypeVariables</code>と一緒に使うと、より厳格に型検査をしてもらえるのよね」</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" title="1"><span class="ot">{-# LANGUAGE InstanceSigs #-}</span></a>
<a class="sourceLine" id="cb8-2" title="2"><span class="ot">{-# LANGUAGE ScopedTypeVariables #-}</span></a>
<a class="sourceLine" id="cb8-3" title="3"></a>
<a class="sourceLine" id="cb8-4" title="4"><span class="kw">newtype</span> <span class="dt">List'</span> a <span class="ot">=</span> <span class="dt">List'</span></a>
<a class="sourceLine" id="cb8-5" title="5">  {<span class="ot"> unList' ::</span> [a]</a>
<a class="sourceLine" id="cb8-6" title="6">  }</a>
<a class="sourceLine" id="cb8-7" title="7"></a>
<a class="sourceLine" id="cb8-8" title="8"><span class="co">-- ランダムなリストを生成するインスタンス</span></a>
<a class="sourceLine" id="cb8-9" title="9"><span class="kw">instance</span> (<span class="dt">Bounded</span> a, <span class="dt">Random</span> a) <span class="ot">=&gt;</span> <span class="dt">Random</span> (<span class="dt">List'</span> a) <span class="kw">where</span></a>
<a class="sourceLine" id="cb8-10" title="10"><span class="ot">  randomR ::</span> <span class="kw">forall</span> g<span class="op">.</span> <span class="dt">RandomGen</span> g <span class="ot">=&gt;</span> (<span class="dt">List'</span> a, <span class="dt">List'</span> a) <span class="ot">-&gt;</span> g <span class="ot">-&gt;</span> (<span class="dt">List'</span> a, g)</a>
<a class="sourceLine" id="cb8-11" title="11">  randomR (<span class="dt">List'</span> xs, <span class="dt">List'</span> ys) gen <span class="ot">=</span></a>
<a class="sourceLine" id="cb8-12" title="12">    <span class="kw">let</span><span class="ot"> randomR' ::</span> a <span class="ot">-&gt;</span> a <span class="ot">-&gt;</span> (a, g)  <span class="co">-- 意図通りの関数を書けてるか、型検査</span></a>
<a class="sourceLine" id="cb8-13" title="13">        randomR' <span class="ot">=</span> <span class="fu">curry</span> <span class="op">$</span> <span class="fu">flip</span> randomR gen</a>
<a class="sourceLine" id="cb8-14" title="14"><span class="ot">        zs' ::</span> [(a, g)]  <span class="co">-- 意図通りの結果を受け取れてるか、型検査</span></a>
<a class="sourceLine" id="cb8-15" title="15">        zs' <span class="ot">=</span> <span class="fu">zipWith</span> randomR' xs ys</a>
<a class="sourceLine" id="cb8-16" title="16">    <span class="kw">in</span> <span class="op">...</span></a></code></pre></div>
<p>にこ「でも、一度コンパイルが通ったら消しちゃうことも少なくないわ…… コンパイル速度が落ちそうな気がしちゃって」</p>
<p>希「どうなんやろな？」</p>
<h1 id="impredicativetypes">ImpredicativeTypes</h1>
<p>にこ「非可述的な……型々？」<br />
希「なんやろこれ？？」</p>
<p>にこ「こういう時はここを見るのが一番ね。 あったあった、GHC Wikiページ！」</p>
<ul>
<li><a href="https://ghc.haskell.org/trac/ghc/wiki/ImpredicativePolymorphism">ImpredicativePolymorphism - GHC</a></li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" title="1"><span class="ot">{-# LANGUAGE ImpredicativeTypes #-}</span></a>
<a class="sourceLine" id="cb9-2" title="2"><span class="ot">{-# LANGUAGE RankNTypes #-}</span></a>
<a class="sourceLine" id="cb9-3" title="3"></a>
<a class="sourceLine" id="cb9-4" title="4"><span class="ot">f ::</span> <span class="dt">Bool</span> <span class="ot">-&gt;</span> b <span class="ot">-&gt;</span> b</a>
<a class="sourceLine" id="cb9-5" title="5">f <span class="ot">=</span> <span class="fu">const</span> <span class="fu">id</span></a>
<a class="sourceLine" id="cb9-6" title="6"></a>
<a class="sourceLine" id="cb9-7" title="7"><span class="ot">g ::</span> (<span class="kw">forall</span> a<span class="op">.</span> a <span class="ot">-&gt;</span> a) <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb9-8" title="8">g <span class="ot">=</span> <span class="fu">undefined</span> <span class="co">--const 10</span></a>
<a class="sourceLine" id="cb9-9" title="9"></a>
<a class="sourceLine" id="cb9-10" title="10"><span class="ot">foo ::</span> <span class="dt">Bool</span> <span class="ot">-&gt;</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb9-11" title="11">foo x <span class="ot">=</span> g <span class="op">$</span> f x</a>
<a class="sourceLine" id="cb9-12" title="12"></a>
<a class="sourceLine" id="cb9-13" title="13"><span class="co">--foo' :: Bool -&gt; Int</span></a>
<a class="sourceLine" id="cb9-14" title="14"><span class="co">--foo' = g . f</span></a>
<a class="sourceLine" id="cb9-15" title="15"></a>
<a class="sourceLine" id="cb9-16" title="16"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb9-17" title="17">main <span class="ot">=</span> <span class="fu">return</span> ()</a></code></pre></div>
<p>にこ「なるほど、うーん。 多分、<code>f</code>の型変数<code>b</code>と、<code>g</code>の<strong>ランク2多相</strong>の型変数<code>a</code>が、同一のものとして具体化できるか というのが問題っぽいわね」</p>
<p>希「<code>ImpredicativeTypes</code>を使うと、こんな感じの型変数<code>x</code>が決定できる？」</p>
<pre><code>      f
Bool --&gt; (x -&gt; x)
    \     |
     \    | g
      \   v
       &gt; Int</code></pre>
<p>にこ「うーん、そうっぽい？」<br />
希「うーん」</p>
<p>…</p>
<p>にこ「<code>g</code>の実定義を<code>g = const 10</code>にしたら、 <code>ImpredicativeTypes</code>を外してもコンパイルが通るわ」<br />
にこ「逆に<code>foo'</code>をコメントインすると、<code>ImpredicativeTypes</code>を有効にしていてもコンパイルが通らないわ」</p>
<p>希「うーん、さらにいろいろ機能があるみたいやね」<br />
希「ここが参考になりそうやん」</p>
<ul>
<li><a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#impredicative-polymorphism">10.1. Language options - Glasgow Haskell Compiler 8.2.2 User’s Guide</a></li>
<li><a href="https://www.microsoft.com/en-us/research/publication/boxy-type-inference-for-higher-rank-types-and-impredicativity/">Boxy type inference for higher-rank types and impredicativity - Microsoft Research</a></li>
</ul>
<h1 id="explicitnamespaces">ExplicitNamespaces</h1>
<p>にこ「ああ、型演算子を作った時に、 importとmoduleでのエクスポートで<code>type</code>って書けるのは この子のおかげだったのね」</p>
<p>Helper.hs</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb11-1" title="1"><span class="ot">{-# LANGUAGE TypeFamilies #-}</span></a>
<a class="sourceLine" id="cb11-2" title="2"><span class="ot">{-# LANGUAGE TypeOperators #-}</span></a>
<a class="sourceLine" id="cb11-3" title="3"></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="kw">module</span> <span class="dt">Helper</span></a>
<a class="sourceLine" id="cb11-5" title="5">  ( <span class="kw">type</span> (<span class="op">-&lt;|</span>)</a>
<a class="sourceLine" id="cb11-6" title="6">  , (<span class="op">-&lt;|</span>)</a>
<a class="sourceLine" id="cb11-7" title="7">  ) <span class="kw">where</span></a>
<a class="sourceLine" id="cb11-8" title="8"></a>
<a class="sourceLine" id="cb11-9" title="9"><span class="kw">type</span> <span class="kw">family</span> (<span class="op">-&lt;|</span>) a b <span class="kw">where</span></a>
<a class="sourceLine" id="cb11-10" title="10">  x <span class="op">-&lt;|</span> _ <span class="ot">=</span> x</a>
<a class="sourceLine" id="cb11-11" title="11"></a>
<a class="sourceLine" id="cb11-12" title="12"><span class="ot">(-&lt;|) ::</span> a <span class="ot">-&gt;</span> b <span class="ot">-&gt;</span> a</a>
<a class="sourceLine" id="cb11-13" title="13">(<span class="op">-&lt;|</span>) <span class="ot">=</span> <span class="fu">const</span></a></code></pre></div>
<p>Main.hs</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb12-1" title="1"><span class="ot">{-# LANGUAGE ExplicitNamespaces #-}</span></a>
<a class="sourceLine" id="cb12-2" title="2"></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co">-- `ExplicitNamespaces` allows 'type' keyword in import/export</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="kw">import</span> <span class="dt">Helper</span> (type (-&lt;|), (-&lt;|))</a>
<a class="sourceLine" id="cb12-5" title="5"></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="ot">x ::</span> (<span class="op">-&lt;|</span>) <span class="dt">Int</span> <span class="dt">Char</span></a>
<a class="sourceLine" id="cb12-7" title="7">x <span class="ot">=</span> <span class="dv">10</span> <span class="op">-&lt;|</span> <span class="ch">'a'</span></a>
<a class="sourceLine" id="cb12-8" title="8"></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="ot">main ::</span> <span class="dt">IO</span> ()</a>
<a class="sourceLine" id="cb12-10" title="10">main <span class="ot">=</span> <span class="fu">return</span> ()</a></code></pre></div>
<p>希「この<code>type</code>ってなんなん？」</p>
<p>にこ「このHelper.hsで、<code>(-&lt;|)</code>は型レベルと値レベルのどちらでも定義されてるでしょ？」<br />
にこ「それだとエクスポート時に<code>module Helper ((-&lt;|)) where</code>って書いたときと、 import時に<code>import Helper ((-&lt;|))</code>って書いたとき」<br />
にこ「それぞれどちらをインポート、エクスポートしたらいいかわからないわよね」</p>
<p>にこ「だから<code>type</code>を指定したときには、型レベルの方を表すの」</p>
<p>希「なるほどな〜。 デフォルトで値レベルの<code>(-&lt;|) :: a -&gt; b -&gt; a</code> を、 <code>type</code>を指定したときには型レベルの<code>(-&lt;|)</code>を扱うって感じやんな！」</p>
<h1 id="夜更け">夜更け</h1>
<p>希「はぁ〜ふぅ」あくび</p>
<p>にこ（……もう24時ね）   にこ「眠い？」<br />
希「うーん、ちょっと眠くなってもうたわ」</p>
<p>にこ「明日眠くなって調子でなかったら大変だし、今日はもう寝ましょうか」<br />
希「せやね〜」</p>
<p>希「楽しかったよ〜。 普段はにこっちから『遊ぼう』って言ってくれることなんてないし」<br />
にこ「悪かったわね。 アイドルに子育てにHaskell。 にこは忙しいのよ」</p>
<p>にこ「でも今日はありがとう、私も楽しかったわ」<br />
希「うんん、いつでも呼んでな。 うち、Haskellerとしてのにこっちのことも、尊敬してるんよ」<br />
にこ「……//」</p>
<h1 id="参考ページ">参考ページ</h1>
<ul>
<li><a href="https://github.com/shiatsumat/wiwinwlh-jp/wiki/%E8%A8%80%E8%AA%9E%E6%8B%A1%E5%BC%B5">言語拡張 - shiatsumat/wiwinwlh-jp Wiki - GitHub</a></li>
<li><a href="http://www.palantir-k.net/palawiki/index.php?%E3%82%A2%E3%83%8B%E3%83%A1%2F%E3%83%A9%E3%83%96%E3%83%A9%E3%82%A4%E3%83%96%2F%E5%89%8D%E5%9B%9E%E3%81%AE%E3%83%A9%E3%83%96%E3%83%A9%E3%82%A4%E3%83%96">アニメ/ラブライブ/前回のラブライブ - Palantir’s Wiki</a></li>
<li><a href="https://togetter.com/li/688135">【ラブライブ！】まさかの呼称に感じた弱さと強さ【矢澤にこ】 - Togetter</a></li>
<li><a href="https://downloads.haskell.org/~ghc/latest/docs/html/users_guide/glasgow_exts.html#overloaded-lists">10.1. Language options - Glasgow Haskell Compiler 8.2.2 User’s Guide</a></li>
</ul>

    <hr />

    <ul class="bookmarkers">
        <li> <!-- See https://about.twitter.com/ja/resources/buttons -->
            <a href="https://twitter.com/share" class="twitter-share-button" data-via="public_ai000ya" data-size="small">Tweet</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </li>

        <li> <!-- See http://b.hatena.ne.jp/guide/bbutton -->
            <a href="http://b.hatena.ne.jp/entry/aiya000.github.io/posts/2017-12-25-learn-haskell-with-muse-extra.html" class="hatena-bookmark-button" data-hatena-bookmark-title="にこ、希と一緒に学ぶHaskell（番外）「あまり知られていないGHC拡張の紹介」 - あいや☆ぱぶりっしゅぶろぐ！" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
            <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
        </li>

        <li> <!-- See https://developers.facebook.com/docs/plugins/like-button?locale=ja_JP#configurator -->
            <div class="fb-like" data-href="https://aiya000.github.io/posts/2017-12-25-learn-haskell-with-muse-extra.html" data-layout="button_count" data-action="like" data-size="small" data-show-faces="false" data-share="true"></div>
        </li>

        <li> <!-- See https://getpocket.com/publisher/button -->
            <a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="ja"></a>
            <script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>
        </li>
    </ul>

    <p class="about-pr">
        この記事はこちらから修正リクエストを送ることができます。 <br />
        <a href="https://github.com/aiya000/aiya000.github.io/blob/src/posts/2017-12-25-learn-haskell-with-muse-extra.md">にこ、希と一緒に学ぶHaskell（番外）「あまり知られていないGHC拡張の紹介」 - github</a> <br />
        ゴミ箱ボタンの左にある、鉛筆ボタンを押してね！
    </p>
</div>

<script src="../js/facebook-sdk-2.8.js"></script>


        <div class="footer">
            (*^o^) { This blog powerd by Haskell <a href="http://jaspervdj.be/hakyll">Hakyll</a>,
            and more (<a href="../licenses.html">about licenses</a>).
        </div>

        <script type="text/javascript" src="../js/jquery-3.1.1.min.js"></script>
        <script type="text/javascript" src="../js/popper.min.js"></script>
        <script type="text/javascript" src="../js/bootstrap.bundle.js"></script>
        <script type="text/javascript" src="../js/fontawesome-all.min.js"></script>
        <script type="text/javascript" src="../js/highlight.pack.js"></script>
        <script>hljs.initHighlightingOnLoad();</script>
    </body>
</html>
