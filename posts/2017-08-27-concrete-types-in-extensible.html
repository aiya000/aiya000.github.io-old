<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>あいや☆ぱぶりっしゅぶろぐ！ - extensibleのAssociateを使ったEff型を具体型にする</title>
        <link rel="stylesheet" type="text/css" href="../css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="../css/default.css" />
        <link rel="stylesheet" type="text/css" href="../css/highlight.css" />
        <!-- bootstrap requires jquery -->
        <script type="text/javascript" src="../js/jquery-3.1.1.min.js"></script>
        <script type="text/javascript" src="../js/bootstrap.min.js"></script>
    </head>
    <body>
        <nav class="navbar navbar-default">
            <div class="navbar-header">
                <a class="navbar-brand" href="../">あいや☆ぱぶりっしゅぶろぐ！</a>
            </div>
            <ul class="nav navbar-nav">
                <li><a href="../">Home</a></li>
                <li><a href="../about.html">About</a></li>
                <li><a href="../profile.html">Profile</a></li>
                <li><a href="../products.html">Products</a></li>
                <li><a href="../archive.html">Archive</a></li>
            </ul>
        </nav>

        <div id="content">
            <h4>extensibleのAssociateを使ったEff型を具体型にする</h4>
            <link rel="stylesheet" type="text/css" href="../css/post.css" />

<div class="info">
    Posted on 2017/08/27 <br />
    

    Tags:
    
        [<a href="../tags/Haskell.html">Haskell</a>]
    

    <ul class="bookmarkers">
        <li> <!-- See https://about.twitter.com/ja/resources/buttons -->
            <a href="https://twitter.com/share" class="twitter-share-button" data-via="public_ai000ya" data-size="small">Tweet</a>
            <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
        </li>

        <li> <!-- See http://b.hatena.ne.jp/guide/bbutton -->
            <a href="http://b.hatena.ne.jp/entry/aiya000.github.io/posts/2017-08-27-concrete-types-in-extensible.html" class="hatena-bookmark-button" data-hatena-bookmark-title="extensibleのAssociateを使ったEff型を具体型にする - あいや☆ぱぶりっしゅぶろぐ！" data-hatena-bookmark-layout="standard-balloon" data-hatena-bookmark-lang="ja" title="このエントリーをはてなブックマークに追加"><img src="https://b.st-hatena.com/images/entry-button/button-only@2x.png" alt="このエントリーをはてなブックマークに追加" width="20" height="20" style="border: none;" /></a>
            <script type="text/javascript" src="https://b.st-hatena.com/js/bookmark_button.js" charset="utf-8" async="async"></script>
        </li>

        <li> <!-- See https://developers.facebook.com/docs/plugins/like-button?locale=ja_JP#configurator -->
            <div class="fb-like" data-href="https://aiya000.github.io/posts/2017-08-27-concrete-types-in-extensible.html" data-layout="button_count" data-action="like" data-size="small" data-show-faces="false" data-share="true"></div>
        </li>

        <li> <!-- See https://getpocket.com/publisher/button -->
            <a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="ja"></a>
            <script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>
        </li>
    </ul>
</div>

<hr />

<p>※ 本記事はextensible-effectsパッケージではなくextensibleパッケージの <code>Data.Extensible.Effect</code>モジュールについての記事です</p>
<h1 id="解答">解答</h1>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">context ::</span> ( <span class="dt">Associate</span> <span class="st">&quot;greet&quot;</span> (<span class="dt">WriterEff</span> [<span class="dt">String</span>]) xs
           , <span class="dt">Associate</span> <span class="st">&quot;message&quot;</span> (<span class="dt">WriterEff</span> [<span class="dt">String</span>]) xs
           ) <span class="ot">=&gt;</span> <span class="dt">Eff</span> xs ()</code></pre></div>
<p>　上記の型を具体化すると</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">context ::</span> <span class="dt">Eff</span> <span class="ch">'[&quot;greet&quot; &gt;: WriterEff [String], &quot;message&quot; &gt;: WriterEff [String]] ()</span></code></pre></div>
<p>という具体型になる。</p>
<h1 id="data.extensible.effectでの抽象的なeff型">Data.Extensible.Effectでの抽象的なEff型</h1>
<p>　extensible-effectsではこのような抽象化された<code>Eff</code>型で、<code>Writer</code>モナド相当の操作ができましたが</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">context ::</span> ( <span class="dt">Member</span> (<span class="dt">Writer</span> [<span class="dt">String</span>]) r
           ) <span class="ot">=&gt;</span> <span class="dt">Eff</span> r ()
context <span class="fu">=</span> <span class="kw">do</span>
  tell [<span class="st">&quot;hi&quot;</span>]
  tell [<span class="st">&quot;thanks !&quot;</span>]</code></pre></div>
<p>　extensibleパッケージでは、<code>WriterEff</code>, <code>ReaderEff</code>などの <code>Data.Extensible.Effect</code>での作用を名前付き（<code>Symbol</code>付き※1）で管理できるので、 重複した作用を別のものとして扱うことができる。</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">context ::</span> ( <span class="dt">Associate</span> <span class="st">&quot;greet&quot;</span> (<span class="dt">WriterEff</span> [<span class="dt">String</span>]) xs
           , <span class="dt">Associate</span> <span class="st">&quot;message&quot;</span> (<span class="dt">WriterEff</span> [<span class="dt">String</span>]) xs
           ) <span class="ot">=&gt;</span> <span class="dt">Eff</span> xs ()
context <span class="fu">=</span> <span class="kw">do</span>
  tellEff <span class="fu">#</span>greet [<span class="st">&quot;hi&quot;</span>]
  tellEff <span class="fu">#</span>message [<span class="st">&quot;extensible, OverloadedLabels, and TypeApplications is great&quot;</span>]
  tellEff <span class="fu">#</span>greet [<span class="st">&quot;thanks !&quot;</span>]
<span class="co">-- これらを</span>
<span class="co">-- leaveEff . runWriterEff @ &quot;message&quot; . runWriterEff @ &quot;greet&quot;</span>
<span class="co">-- すると</span>
<span class="co">-- (((),[&quot;hi&quot;,&quot;thanks !&quot;]),[&quot;extensible, OverloadedLabels, and TypeApplications is great&quot;])</span>
<span class="co">-- という値が得られる</span></code></pre></div>
<ul>
<li>参考になる公式記事
<ul>
<li><a href="https://hackage.haskell.org/package/extensible-0.4.3">extensible: Extensible, efficient, optics-friendly data types and effects</a></li>
<li><a href="https://www.schoolofhaskell.com/user/fumieval/extensible">extensible - School of Haskell | School of Haskell</a></li>
</ul></li>
</ul>
<h2 id="section">※1</h2>
<p>　<code>String</code>（<code>[Char]</code>）を種に昇格すると<code>Symbol</code>になるっぽい？ まだ調べてない。</p>
<ul>
<li><a href="https://www.stackage.org/haddock/lts-9.1/ghc-prim-0.5.0.0/GHC-Types.html#t:Symbol">GHC.Types</a></li>
</ul>
<h1 id="data.extensible.effectでの具体的なeff型">Data.Extensible.Effectでの具体的なEff型</h1>
<p>　上の型</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">context ::</span> ( <span class="dt">Associate</span> <span class="st">&quot;greet&quot;</span> (<span class="dt">WriterEff</span> [<span class="dt">String</span>]) xs
           , <span class="dt">Associate</span> <span class="st">&quot;message&quot;</span> (<span class="dt">WriterEff</span> [<span class="dt">String</span>]) xs
           ) <span class="ot">=&gt;</span> <span class="dt">Eff</span> xs ()</code></pre></div>
<p>を解凍する関数</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">leaveEff <span class="fu">.</span> runWriterEff <span class="fu">@</span> <span class="st">&quot;message&quot;</span> <span class="fu">.</span> runWriterEff <span class="fu">@</span> <span class="st">&quot;greet&quot;</span></code></pre></div>
<p>の型をGHCのtyped hole機能で調べてみると</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">(<span class="dt">Monoid</span> w, <span class="dt">Monoid</span> w1)
<span class="ot">=&gt;</span> <span class="dt">Eff</span> <span class="ch">'[&quot;greet&quot; &gt;: WriterEff w, &quot;message&quot; &gt;: WriterEff w1] a</span>
   <span class="ot">-&gt;</span> ((a, w), w1)</code></pre></div>
<p>と出る。</p>
<p>　ちょうど我々がそこに当てはめている<code>Monoid</code>は<code>[String]</code>なので、</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell">leaveEff <span class="fu">.</span> runWriterEff <span class="fu">@</span> <span class="st">&quot;message&quot;</span> <span class="fu">.</span> runWriterEff <span class="fu">@</span> <span class="st">&quot;greet&quot;</span>
<span class="ot">::</span> <span class="dt">Eff</span> <span class="ch">'[&quot;greet&quot; &gt;: WriterEff [String], &quot;message&quot; &gt;: WriterEff [String]] ()</span>
   <span class="ot">-&gt;</span> (((), [<span class="dt">String</span>]), [<span class="dt">String</span>])</code></pre></div>
<p>である。</p>
<p>　なので</p>
<div class="sourceCode"><pre class="sourceCode haskell"><code class="sourceCode haskell"><span class="ot">context ::</span> <span class="dt">Eff</span> <span class="ch">'[&quot;greet&quot; &gt;: WriterEff [String], &quot;message&quot; &gt;: WriterEff [String]] ()</span></code></pre></div>
<p>である。</p>
<h1 id="余談">余談</h1>
<p>　<code>#foo</code>というのは<code>OverloadedLabels</code>拡張の機能で、<code>@ Bar</code>というのは<code>TypeApplications</code>拡張の機能。</p>

<hr />
<hr />

<p class="about-pr">
この記事はこちらから修正リクエストを送ることができます。 <br />
<a href="https://github.com/aiya000/aiya000.github.io/blob/src/posts/2017-08-27-concrete-types-in-extensible.md">extensibleのAssociateを使ったEff型を具体型にする - github</a> <br />
ゴミ箱ボタンの左にある、鉛筆ボタンを押してね！
</p>

<script src="../js/facebook-sdk-2.8.js"></script>

        </div>

        <div id="footer">
            (*^o^) { This blog powerd by Haskell <a href="http://jaspervdj.be/hakyll">Hakyll</a> <br />
            and Uses <a href="http://nkmr6194.github.io/Umi/">Umi</a>
        </div>
    </body>
</html>
